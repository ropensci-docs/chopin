<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Generate computational grids â€¢ chopin</title>
<!-- rOpenSci favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate computational grids">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.css">
<script src="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.umd.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">chopin</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.9.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/v01_start.html">Getting started with chopin</a></li>
    <li><a class="dropdown-item" href="../articles/v02_good_practice.html">Good practice of using `chopin`</a></li>
    <li><a class="dropdown-item" href="../articles/v03_par_pad_grid.html">Generate computational grids</a></li>
    <li><a class="dropdown-item" href="../articles/v04_climate_examples.html">Extracting Weather/Climate Geospatial Data with `chopin`</a></li>
    <li><a class="dropdown-item" href="../articles/v05_targets.html">targets and grid objects</a></li>
  </ul>
</li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/chopin/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Generate computational grids</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/chopin/blob/master/vignettes/v03_par_pad_grid.Rmd" class="external-link"><code>vignettes/v03_par_pad_grid.Rmd</code></a></small>
      <div class="d-none name"><code>v03_par_pad_grid.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/chopin">chopin</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dplyr'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter, lag</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     intersect, setdiff, setequal, union</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.4.0; sf_use_s2() is TRUE</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## terra 1.8.10</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/m-Py/anticlust" class="external-link">anticlust</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'igraph'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:terra':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     blocks, compare, union</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:dplyr':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     as_data_frame, groups, union</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     decompose, spectrum</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     union</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'future'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:igraph':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     %-&gt;%, %&lt;-%</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.mirai.futureverse.org" class="external-link">future.mirai</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>sf_use_s2 <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="computational-grids">Computational grids<a class="anchor" aria-label="anchor" href="#computational-grids"></a>
</h2>
<ul>
<li>Computational grids refer to a set of polygons that cover the entire
spatial domain of interest. These grids are used to split the spatial
domain into smaller pieces for parallel processing.</li>
<li>
<code>chopin</code> provides functions to generate computational
grids for parallel processing by <code><a href="../reference/par_grid.html">par_grid()</a></code> function.</li>
<li>The standard sequence of running <code><a href="../reference/par_grid.html">par_grid()</a></code> includes
the following steps:
<ol style="list-style-type: decimal">
<li>Generate computational grids with <code><a href="../reference/par_pad_grid.html">par_pad_grid()</a></code> or
<code><a href="../reference/par_pad_balanced.html">par_pad_balanced()</a></code>. This step will give you a set of grid
polygons, one of which is original splits and the other is padded in
consideration of buffer radius in the subsequent spatial
operations.</li>
<li>Run <code><a href="../reference/par_grid.html">par_grid()</a></code> with the input dataset and the grid
polygons.</li>
</ol>
</li>
<li>Before advancing, we define terms for clarity.
<ul>
<li>
<strong>Input data</strong>: the data where the computed value will
be stored. For example, when extracting raster values with vector
objects, vector objects are the input data.</li>
<li>
<strong>Target data</strong>: the data <em>from</em> which the
values come. In the example above, raster object is the target
data.</li>
</ul>
</li>
<li>Original and padded grids will be used to split the main input with
the original grid and the target dataset for computation with the padded
grid, respectively.</li>
</ul>
</div>
<div class="section level2">
<h2 id="types-of-computational-grids-and-their-generation">Types of computational grids and their generation<a class="anchor" aria-label="anchor" href="#types-of-computational-grids-and-their-generation"></a>
</h2>
<ul>
<li>There are two approaches to generate computational grids. One is to
use <code><a href="../reference/par_pad_grid.html">par_pad_grid()</a></code> with one of three <code>mode</code>s and
the other is to use <code>par_group_grid()</code>. Thus, users have
<strong>four options</strong> in total to generate computational
grids.</li>
<li>
<code>padding</code> argument is very important to ensure the
accurate parallel operations in a case where buffering is involved.
Suppose a user has point geometry inputs and apply circular buffer with
a certain radius. Since the original grid (without padding = no overlap
between adjacent grids) filters the original input in each parallel
worker, points near each grid border may miss target data as buffered
polygons exceed the grid.</li>
</ul>
<div class="section level3">
<h3 id="par_pad_grid-standard-interface">
<code>par_pad_grid()</code>: standard interface<a class="anchor" aria-label="anchor" href="#par_pad_grid-standard-interface"></a>
</h3>
<ul>
<li>
<code><a href="../reference/par_pad_grid.html">par_pad_grid()</a></code> generates regular grid polygons with
padding for parallel processing. Padding is the distance of overlapping
between grid polygons, essentially from the buffer radius of the points
when buffer polygons are concerned.</li>
<li>
<code><a href="../reference/par_pad_grid.html">par_pad_grid()</a></code> supports three internal
<code>mode</code>s:
<ul>
<li>
<code>mode = "grid"</code>: generates regular grid polygons with
padding, <code>nx</code> and <code>ny</code> arguments determine the
number of columns and rows in the grid, respectively.</li>
<li>
<code>mode = "grid_quantile"</code>: generates regular grid polygons
with padding based on quantiles of the number of points in each grid.
The grids will look irregular and the points per grid will be more
balanced than the <code>grid</code> mode.</li>
<li>
<code>mode = "grid_advanced"</code>: generates regular grid polygons
with padding based on the number of points in each grid and the number
of points in the entire dataset. <code>nx</code> and <code>ny</code>
arguments determine the number of columns and rows in the grid, then
<code>merge_max</code> argument controls how many adjacent grids are
merged into one grid. <code>grid_min_features</code> argument determines
the minimum number of points in each grid, which means grids with fewer
points than this value will be merged with adjacent grids. Adjusting
these arguments can balance the computational load among the threads and
reduce the overhead of parallelization.</li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="par_pad_balanced-focusing-on-getting-the-balanced-clusters">
<code>par_pad_balanced()</code>: focusing on getting the balanced
clusters<a class="anchor" aria-label="anchor" href="#par_pad_balanced-focusing-on-getting-the-balanced-clusters"></a>
</h3>
<ul>
<li>
<code><a href="../reference/par_pad_balanced.html">par_pad_balanced()</a></code> groups the inputs into equal size,
then generates padded rectangles that cover the same number of points
per grid. Users can use the output of this function into
<code><a href="../reference/par_grid.html">par_grid()</a></code> for parallel processing.</li>
</ul>
</div>
<div class="section level3">
<h3 id="random-points-in-nc">Random points in NC<a class="anchor" aria-label="anchor" href="#random-points-in-nc"></a>
</h3>
<ul>
<li>For demonstration of <code><a href="../reference/par_pad_grid.html">par_pad_grid()</a></code>, we use moderately
clustered point locations generated inside the counties of North
Carolina.</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncpoly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shape/nc.shp"</span>, package <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span>
<span><span class="va">ncsf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="va">ncpoly</span><span class="op">)</span></span>
<span><span class="va">ncsf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">ncsf</span>, <span class="st">"EPSG:5070"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">ncsf</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_par_pad_grid_files/figure-html/nc-gen-points-1.png" width="700"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sampling clustered point</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://spatstat.org/" class="external-link">spatstat.random</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: spatstat.data</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: spatstat.univar</span></span></code></pre>
<pre><code><span><span class="co">## spatstat.univar 3.1-1</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: spatstat.geom</span></span></code></pre>
<pre><code><span><span class="co">## spatstat.geom 3.3-5</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'spatstat.geom'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:igraph':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     diameter, edges, is.connected, vertices</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:terra':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     area, delaunay, is.empty, rescale, rotate, shift, where.max,</span></span>
<span><span class="co">##     where.min</span></span></code></pre>
<pre><code><span><span class="co">## spatstat.random 3.3-2</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">202404</span><span class="op">)</span></span>
<span><span class="va">ncpoints</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html" class="external-link">st_sample</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">ncsf</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"Thomas"</span>,</span>
<span>    mu <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    scale <span class="op">=</span> <span class="fl">1e4</span>,</span>
<span>    kappa <span class="op">=</span> <span class="fl">1.25e-9</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">ncpoints</span> <span class="op">&lt;-</span> <span class="va">ncpoints</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">2e3L</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">ncpoints</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">ncpoints</span><span class="op">)</span></span>
<span><span class="va">ncpoints</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_set_crs</a></span><span class="op">(</span><span class="va">ncpoints</span>, <span class="st">"EPSG:5070"</span><span class="op">)</span></span>
<span><span class="va">ncpoints</span><span class="op">$</span><span class="va">pid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"PID-%05d"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ncpoints</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">ncpoints</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_par_pad_grid_files/figure-html/nc-gen-points-2.png" width="700"></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># convert to terra SpatVector</span></span>
<span><span class="va">ncpoints_tr</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">ncpoints</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="visualize-computational-grids">Visualize computational grids<a class="anchor" aria-label="anchor" href="#visualize-computational-grids"></a>
</h2>
<ul>
<li>The output of <code><a href="../reference/par_pad_grid.html">par_pad_grid()</a></code> and
<code><a href="../reference/par_pad_balanced.html">par_pad_balanced()</a></code> is length 2 list. A significant
difference between the two is the first element of the output. In
<code><a href="../reference/par_pad_grid.html">par_pad_grid()</a></code>, it is always a sf or SpatVector object with
polygon geometries. On the other hand, <code><a href="../reference/par_pad_balanced.html">par_pad_balanced()</a></code>
will have the first element as a sf or SpatVector object with the same
geometry type as the original input. For example, it will have point
geometries if the input was point.</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compregions</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">chopin</span><span class="fu">::</span><span class="fu"><a href="../reference/par_pad_grid.html">par_pad_grid</a></span><span class="op">(</span></span>
<span>    <span class="va">ncpoints_tr</span>,</span>
<span>    mode <span class="op">=</span> <span class="st">"grid"</span>,</span>
<span>    nx <span class="op">=</span> <span class="fl">8L</span>,</span>
<span>    ny <span class="op">=</span> <span class="fl">5L</span>,</span>
<span>    padding <span class="op">=</span> <span class="fl">1e4L</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># a list object</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">compregions</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "list"</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># length of 2</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">compregions</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "original" "padded"</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">compregions</span><span class="op">$</span><span class="va">original</span>, main <span class="op">=</span> <span class="st">"Original grids"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">compregions</span><span class="op">$</span><span class="va">padded</span>, main <span class="op">=</span> <span class="st">"Padded grids"</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_par_pad_grid_files/figure-html/grid-plain-1.png" width="700"></p>
<div class="section level3">
<h3 id="generate-regular-grid-computational-regions">Generate regular grid computational regions<a class="anchor" aria-label="anchor" href="#generate-regular-grid-computational-regions"></a>
</h3>
<ul>
<li>
<code><a href="../reference/par_pad_grid.html">chopin::par_pad_grid()</a></code> takes a spatial dataset to
generate regular grid polygons with <code>nx</code> and <code>ny</code>
arguments with padding. Users will have both overlapping (by the degree
of <code>radius</code>) and non-overlapping grids, both of which will be
utilized to split locations and target datasets into sub-datasets for
efficient processing.</li>
</ul>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compregions</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">chopin</span><span class="fu">::</span><span class="fu"><a href="../reference/par_pad_grid.html">par_pad_grid</a></span><span class="op">(</span></span>
<span>    <span class="va">ncpoints_tr</span>,</span>
<span>    mode <span class="op">=</span> <span class="st">"grid"</span>,</span>
<span>    nx <span class="op">=</span> <span class="fl">8L</span>,</span>
<span>    ny <span class="op">=</span> <span class="fl">5L</span>,</span>
<span>    padding <span class="op">=</span> <span class="fl">1e4L</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<ul>
<li>The output of <code><a href="../reference/par_pad_grid.html">par_pad_grid()</a></code> is a list object with two
elements named <code>original</code> (non-overlapping grid polygons) and
<code>padded</code> (overlapping by <code>padding</code>). The class of
each element depends on the input dataset class. The figures below
illustrate the grid polygons with and without overlaps.</li>
</ul>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">compregions</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "original" "padded"</span></span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">compregions</span><span class="op">$</span><span class="va">original</span>, main <span class="op">=</span> <span class="st">"Original grids"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">compregions</span><span class="op">$</span><span class="va">padded</span>, main <span class="op">=</span> <span class="st">"Padded grids"</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_par_pad_grid_files/figure-html/compare-compregions-1.png" width="768"></p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">compregions</span><span class="op">$</span><span class="va">original</span>, main <span class="op">=</span> <span class="st">"Original grids"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ncpoints_tr</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"red"</span>, cex <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_par_pad_grid_files/figure-html/compare-compregions-2.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="split-the-points-by-two-1d-quantiles">Split the points by two 1D quantiles<a class="anchor" aria-label="anchor" href="#split-the-points-by-two-1d-quantiles"></a>
</h3>
<ul>
<li>
<code>mode = "grid_quantile"</code> generates regular grid polygons
with padding based on quantiles of the coordinates in each
dimension.</li>
<li>When using this mode, users should define <code>quantiles</code>
argument, which will be used to get the same number of quantiles in each
dimension. A convenient way to define <code><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq()</a></code> function with
<code>length.out</code> argument. The example below uses
<code>length.out = 5</code>, which will give quartiles.</li>
</ul>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_quantiles</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">chopin</span><span class="fu">::</span><span class="fu"><a href="../reference/par_pad_grid.html">par_pad_grid</a></span><span class="op">(</span></span>
<span>    input <span class="op">=</span> <span class="va">ncpoints_tr</span>,</span>
<span>    mode <span class="op">=</span> <span class="st">"grid_quantile"</span>,</span>
<span>    quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>    padding <span class="op">=</span> <span class="fl">1e4L</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">grid_quantiles</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "original" "padded"</span></span></code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid_quantiles</span><span class="op">$</span><span class="va">original</span>, main <span class="op">=</span> <span class="st">"Original grids"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid_quantiles</span><span class="op">$</span><span class="va">padded</span>, main <span class="op">=</span> <span class="st">"Padded grids"</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_par_pad_grid_files/figure-html/split-points-grid-1.png" width="700"></p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid_quantiles</span><span class="op">$</span><span class="va">original</span>, main <span class="op">=</span> <span class="st">"Original grids"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ncpoints_tr</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"red"</span>, cex <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_par_pad_grid_files/figure-html/split-points-grid-2.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="merge-the-grids-based-on-the-number-of-points">Merge the grids based on the number of points<a class="anchor" aria-label="anchor" href="#merge-the-grids-based-on-the-number-of-points"></a>
</h3>
<ul>
<li>
<code>mode = "grid_advanced"</code> utilizes finer grids to merge
the results from the finer grids into the coarser grids. This behavior
can balance the computational load among the threads and reduce the
overhead of parallelization. That said, this mode internally generates
grids in <code>mode = "grid"</code> and merges them based on the number
of points in each grid.</li>
<li>To determine the adjacency and merging behavior, minimum spanning
tree (MST) is identified. The function utilizes
<code><a href="https://r.igraph.org/reference/mst.html" class="external-link">igraph::mst()</a></code> for MST identification and other graph
summary functions under the hood.</li>
<li>As a note, users can adjust the merging behavior by changing the
arguments <code>grid_min_features</code> and
<code>merge_max</code>.</li>
</ul>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_advanced1</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">chopin</span><span class="fu">::</span><span class="fu"><a href="../reference/par_pad_grid.html">par_pad_grid</a></span><span class="op">(</span></span>
<span>    input <span class="op">=</span> <span class="va">ncpoints_tr</span>,</span>
<span>    mode <span class="op">=</span> <span class="st">"grid_advanced"</span>,</span>
<span>    nx <span class="op">=</span> <span class="fl">15L</span>,</span>
<span>    ny <span class="op">=</span> <span class="fl">8L</span>,</span>
<span>    padding <span class="op">=</span> <span class="fl">1e4L</span>,</span>
<span>    grid_min_features <span class="op">=</span> <span class="fl">25L</span>,</span>
<span>    merge_max <span class="op">=</span> <span class="fl">5L</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Switch terra class to sf...</span></span>
<span><span class="co">## Switch terra class to sf...</span></span>
<span><span class="co">## <span style="color: #00BBBB;">â„¹</span> The merged polygons have too complex shapes.</span></span>
<span><span class="co">## Increase threshold or use the original grids.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Switch sf class to terra...</span></span></code></pre>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid_advanced1</span><span class="op">$</span><span class="va">original</span>, main <span class="op">=</span> <span class="st">"Original grids"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid_advanced1</span><span class="op">$</span><span class="va">padded</span>, main <span class="op">=</span> <span class="st">"Padded grids"</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_par_pad_grid_files/figure-html/split-points-grid-adv-1.png" width="700"></p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid_advanced1</span><span class="op">$</span><span class="va">original</span>, main <span class="op">=</span> <span class="st">"Merged grids (merge_max = 5)"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ncpoints_tr</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"red"</span>, cex <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_par_pad_grid_files/figure-html/split-points-grid-adv-2.png" width="700"></p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncpoints_tr</span><span class="op">$</span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">n_points</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/zonal.html" class="external-link">zonal</a></span><span class="op">(</span></span>
<span>    <span class="va">ncpoints_tr</span>,</span>
<span>    <span class="va">grid_advanced1</span><span class="op">$</span><span class="va">original</span>,</span>
<span>    fun <span class="op">=</span> <span class="st">"sum"</span></span>
<span>  <span class="op">)</span><span class="op">[[</span><span class="st">"n"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">grid_advanced1g</span> <span class="op">&lt;-</span> <span class="va">grid_advanced1</span><span class="op">$</span><span class="va">original</span></span>
<span><span class="va">grid_advanced1g</span><span class="op">$</span><span class="va">n_points</span> <span class="op">&lt;-</span> <span class="va">n_points</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid_advanced1g</span>, <span class="st">"n_points"</span>, main <span class="op">=</span> <span class="st">"Number of points in each grid"</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_par_pad_grid_files/figure-html/split-points-count-1.png" width="700"></p>
<div class="section level4">
<h4 id="different-values-in-merge_max">Different values in <code>merge_max</code><a class="anchor" aria-label="anchor" href="#different-values-in-merge_max"></a>
</h4>
<ul>
<li>Keeping other arguments the same, we can see the difference in the
number of merged grids by changing the <code>merge_max</code>
argument.</li>
</ul>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_advanced2</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">chopin</span><span class="fu">::</span><span class="fu"><a href="../reference/par_pad_grid.html">par_pad_grid</a></span><span class="op">(</span></span>
<span>    input <span class="op">=</span> <span class="va">ncpoints_tr</span>,</span>
<span>    mode <span class="op">=</span> <span class="st">"grid_advanced"</span>,</span>
<span>    nx <span class="op">=</span> <span class="fl">15L</span>,</span>
<span>    ny <span class="op">=</span> <span class="fl">8L</span>,</span>
<span>    padding <span class="op">=</span> <span class="fl">1e4L</span>,</span>
<span>    grid_min_features <span class="op">=</span> <span class="fl">30L</span>,</span>
<span>    merge_max <span class="op">=</span> <span class="fl">4L</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Switch terra class to sf...</span></span>
<span><span class="co">## Switch terra class to sf...</span></span>
<span><span class="co">## <span style="color: #00BBBB;">â„¹</span> The merged polygons have too complex shapes.</span></span>
<span><span class="co">## Increase threshold or use the original grids.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Switch sf class to terra...</span></span></code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid_advanced2</span><span class="op">$</span><span class="va">original</span>, main <span class="op">=</span> <span class="st">"Original grids"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid_advanced2</span><span class="op">$</span><span class="va">padded</span>, main <span class="op">=</span> <span class="st">"Padded grids"</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_par_pad_grid_files/figure-html/split-points-grid-adv2-1.png" width="700"></p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid_advanced2</span><span class="op">$</span><span class="va">original</span>, main <span class="op">=</span> <span class="st">"Merged grids (merge_max = 8)"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ncpoints_tr</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"red"</span>, cex <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_par_pad_grid_files/figure-html/split-points-grid-adv2-2.png" width="700"></p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_advanced3</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">chopin</span><span class="fu">::</span><span class="fu"><a href="../reference/par_pad_grid.html">par_pad_grid</a></span><span class="op">(</span></span>
<span>    input <span class="op">=</span> <span class="va">ncpoints_tr</span>,</span>
<span>    mode <span class="op">=</span> <span class="st">"grid_advanced"</span>,</span>
<span>    nx <span class="op">=</span> <span class="fl">15L</span>,</span>
<span>    ny <span class="op">=</span> <span class="fl">8L</span>,</span>
<span>    padding <span class="op">=</span> <span class="fl">1e4L</span>,</span>
<span>    grid_min_features <span class="op">=</span> <span class="fl">25L</span>,</span>
<span>    merge_max <span class="op">=</span> <span class="fl">3L</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Switch terra class to sf...</span></span>
<span><span class="co">## Switch terra class to sf...</span></span>
<span><span class="co">## <span style="color: #00BBBB;">â„¹</span> The merged polygons have too complex shapes.</span></span>
<span><span class="co">## Increase threshold or use the original grids.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Switch sf class to terra...</span></span></code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid_advanced3</span><span class="op">$</span><span class="va">original</span>, main <span class="op">=</span> <span class="st">"Original grids"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid_advanced3</span><span class="op">$</span><span class="va">padded</span>, main <span class="op">=</span> <span class="st">"Padded grids"</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_par_pad_grid_files/figure-html/split-points-grid-adv3-1.png" width="700"></p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grid_advanced3</span><span class="op">$</span><span class="va">original</span>, main <span class="op">=</span> <span class="st">"Merged grids (merge_max = 3)"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ncpoints_tr</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"red"</span>, cex <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_par_pad_grid_files/figure-html/split-points-grid-adv3-2.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="par_make_balanced">
<code>par_make_balanced()</code><a class="anchor" aria-label="anchor" href="#par_make_balanced"></a>
</h4>
<ul>
<li>
<code><a href="../reference/par_make_balanced.html">par_make_balanced()</a></code> uses <code>anticlust</code> package
to split the point set into the balanced clusters.
<ul>
<li>In the background, <code><a href="../reference/par_pad_balanced.html">par_pad_balanced()</a></code> is run first to
generate the equally sized clusters from the input. Then, padding is
applied to the extent of each cluster to be compatible with
<code><a href="../reference/par_grid.html">par_grid()</a></code>, where both the original and the padded grids
are used.</li>
<li>Please note that <code>ngroups</code> argument value must be the
<strong>exact</strong> divisor of the number of points. For example, in
the example below, when one changes <code>ngroups</code> to
<code>10L</code>, it will fail as the number of points is not divisible
by 10.</li>
<li>Consult the <a href="https://cran.r-project.org/web/packages/anticlust/index.html" class="external-link"><code>anticlust</code></a>
package for more details on the algorithm.</li>
</ul>
</li>
<li>
<code><a href="../reference/par_pad_balanced.html">par_pad_balanced()</a></code> makes a compatible object to the
output of <code><a href="../reference/par_pad_grid.html">par_pad_grid()</a></code> directly from the input
points.</li>
<li>As illustrated in the figure below, the points will be split into
<code>ngroups</code> clusters with the same number of points then
processed in parallel by using the output object with
<code><a href="../reference/par_grid.html">par_grid()</a></code>.</li>
</ul>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ngroups should be the exact divisor of the number of points!</span></span>
<span><span class="va">group_bal_grid</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">chopin</span><span class="fu">::</span><span class="fu"><a href="../reference/par_pad_balanced.html">par_pad_balanced</a></span><span class="op">(</span></span>
<span>    points_in <span class="op">=</span> <span class="va">ncpoints_tr</span>,</span>
<span>    ngroups <span class="op">=</span> <span class="fl">10L</span>,</span>
<span>    padding <span class="op">=</span> <span class="fl">1e4</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">group_bal_grid</span><span class="op">$</span><span class="va">original</span><span class="op">$</span><span class="va">CGRIDID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/is.bool.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">group_bal_grid</span><span class="op">$</span><span class="va">original</span><span class="op">$</span><span class="va">CGRIDID</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">group_bal_grid</span><span class="op">$</span><span class="va">original</span>, <span class="st">"CGRIDID"</span>,</span>
<span>            legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            main <span class="op">=</span> <span class="st">"Assigned points (ngroups = 10)"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">group_bal_grid</span><span class="op">$</span><span class="va">padded</span>, main <span class="op">=</span> <span class="st">"Padded grids"</span><span class="op">)</span></span></code></pre></div>
<p><img src="v03_par_pad_grid_files/figure-html/par-group-balanced-1.png" width="700"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>





  </body>
</html>
