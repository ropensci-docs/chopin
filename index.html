<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Computation of Spatial Data by Hierarchical and Objective Partitioning of Inputs for Parallel Processing • chopin</title>
<!-- rOpenSci favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><script src="deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Computation of Spatial Data by Hierarchical and Objective Partitioning of Inputs for Parallel Processing">
<meta name="description" content="Geospatial data computation is parallelized by grid, hierarchy, or raster files. Based on future and mirai parallel backends, terra and sf functions as well as convenience functions in the package can be distributed over multiple threads. The simplest way of parallelizing generic geospatial computation is to start from `par_pad_*` functions to `par_grid`, `par_hierarchy`, or `par_multirasters` functions. Virtually any functions accepting classes in terra or sf packages can be used in the three parallelization functions. A common raster-vector overlay operation is provided as a function `extract_at`, which uses exactextractr, with options for kernel weights for summarizing raster values at vector geometries. Other convenience functions for vector-vector operations including simple areal interpolation (`summarize_aw`) and summation of exponentially decaying weights (`summarize_sedc`) are also provided.">
<meta property="og:description" content="Geospatial data computation is parallelized by grid, hierarchy, or raster files. Based on future and mirai parallel backends, terra and sf functions as well as convenience functions in the package can be distributed over multiple threads. The simplest way of parallelizing generic geospatial computation is to start from `par_pad_*` functions to `par_grid`, `par_hierarchy`, or `par_multirasters` functions. Virtually any functions accepting classes in terra or sf packages can be used in the three parallelization functions. A common raster-vector overlay operation is provided as a function `extract_at`, which uses exactextractr, with options for kernel weights for summarizing raster values at vector geometries. Other convenience functions for vector-vector operations including simple areal interpolation (`summarize_aw`) and summation of exponentially decaying weights (`summarize_sedc`) are also provided.">
<meta property="og:image" content="https://docs.ropensci.org/chopin/logo.svg">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.css">
<script src="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.umd.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="index.html">chopin</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.9.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/v01_start.html">Getting started with chopin</a></li>
    <li><a class="dropdown-item" href="articles/v02_good_practice.html">Good practice of using `chopin`</a></li>
    <li><a class="dropdown-item" href="articles/v03_par_pad_grid.html">Generate computational grids</a></li>
    <li><a class="dropdown-item" href="articles/v04_climate_examples.html">Extracting Weather/Climate Geospatial Data with `chopin`</a></li>
    <li><a class="dropdown-item" href="articles/v05_targets.html">targets and grid objects</a></li>
  </ul>
</li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/chopin/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.svg" class="logo" alt=""><h1 id="computation-of-spatial-data-by-hierarchical-and-objective-partitioning-of-inputs-for-parallel-processing-">Computation of Spatial Data by Hierarchical and Objective Partitioning of Inputs for Parallel Processing 
<a class="anchor" aria-label="anchor" href="#computation-of-spatial-data-by-hierarchical-and-objective-partitioning-of-inputs-for-parallel-processing-"></a>
</h1>
</div>
<!-- badges: start -->
<!-- [![cov](https://docs.ropensci.org/chopin/badges/coverage.svg)](https://github.com/ropensci/chopin/actions) -->

<!-- badges: end -->
<div class="section level2">
<h2 id="objective">Objective<a class="anchor" aria-label="anchor" href="#objective"></a>
</h2>
<p>This package automates <a href="https://en.wikipedia.org/wiki/Parallel_computing" class="external-link">parallelization</a> in spatial operations with <code>chopin</code> functions as well as <a href="https://github.com/r-spatial/sf" class="external-link">sf</a>/<a href="https://github.com/rspatial/terra" class="external-link">terra</a> functions. With <a href="https://gdal.org" class="external-link">GDAL</a>-compatible files and database tables, <code>chopin</code> functions help to calculate spatial variables from vector and raster data with no external software requirements. All who need to perform geospatial operations with large datasets may find this package useful to accelerate the covariate calculation process for further analysis and modeling may find the main functions useful. We assume that users have basic knowledge of <a href="https://r.geocompx.org/spatial-class" class="external-link">geographic information system data models</a>, <a href="https://doi.org/10.22224/gistbok/2023.1.2" class="external-link">coordinate systems and transformations</a>, <a href="https://r.geocompx.org/spatial-operations" class="external-link">spatial operations</a>, and <a href="https://r.geocompx.org/raster-vector" class="external-link">raster-vector overlay</a>.</p>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p><code>chopin</code> encapsulates the parallel processing of spatial computation into three steps. <strong>First,</strong> users will define the parallelization strategy, which is one of many supported in <code>future</code> and <code>future.mirai</code> packages. Users always need to register parallel workers with <code>future</code> before running the <code>par_*()</code> functions that will be introduced below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future.mirai</span><span class="fu">::</span><span class="va"><a href="https://future.mirai.futureverse.org/reference/mirai_multisession.html" class="external-link">mirai_multisession</a></span>, workers <span class="op">=</span> <span class="fl">4L</span><span class="op">)</span></span>
<span><span class="co"># future::multisession, future::cluster are available,</span></span>
<span><span class="co"># See future.batchtools and future.callr for other options</span></span>
<span><span class="co"># the number of workers are up to users' choice</span></span></code></pre></div>
<p><strong>Second,</strong> users choose the proper data parallelization configuration by creating a grid partition of the processing extent, defining the field name with values that are hierarchically coded, or entering multiple raster file paths into <code><a href="reference/par_multirasters.html">par_multirasters()</a></code>. <strong>Finally,</strong> users run <code>par_*()</code> function with the configurations set above to compute spatial variables from input data in parallel:</p>
<ul>
<li><p><code>par_grid</code>: parallelize over artificial grid polygons that are generated from the maximum extent of inputs. <code>par_pad_grid</code> is used to generate the grid polygons before running this function.</p></li>
<li><p><code>par_hierarchy</code>: parallelize over hierarchy coded in identifier fields (for example, census blocks in each county in the US)</p></li>
<li><p><code>par_multirasters</code>: parallelize over multiple raster files</p></li>
<li><p>Each of the <code>par_*</code> functions introduced above has <code>mirai</code> version with a suffix <code>_mirai</code> after the function names: <code>par_grid_mirai</code>, <code>par_hierarchy_mirai</code>, and <code>par_multirasters</code>. These functions will work properly after creating daemons with <code><a href="https://shikokuchuo.net/mirai/reference/daemons.html" class="external-link">mirai::daemons</a></code>.</p></li>
</ul>
<!-- end list --><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mirai</span><span class="fu">::</span><span class="fu"><a href="https://shikokuchuo.net/mirai/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span><span class="fl">4L</span>, dispatcher <span class="op">=</span> <span class="st">"process"</span><span class="op">)</span></span></code></pre></div>
<p>For grid partitioning, the entire study area will be divided into partly overlapped grids. We suggest two flowcharts to help which function to use for parallel processing below. The upper flowchart is raster-oriented and the lower is vector-oriented. They are supplementary to each other. When a user follows the raster-oriented one, they might visit the vector-oriented flowchart at each end of the raster-oriented flowchart.</p>
<p>Processing functions accept <a href="https://github.com/rspatial/terra" class="external-link">terra</a>/<a href="https://github.com/r-spatial/sf" class="external-link">sf</a> classes for spatial data. Raster-vector overlay is done with <code>exactextractr</code>. Three helper functions encapsulate multiple geospatial data calculation steps over multiple CPU threads.</p>
<ul>
<li><p><code>extract_at</code>: extract raster values with point buffers or polygons with or without kernel weights</p></li>
<li><p><code>summarize_sedc</code>: calculate sums of <a href="https://mserre.sph.unc.edu/BMElab_web/SEDCtutorial/index.html" class="external-link">exponentially decaying contributions</a></p></li>
<li><p><code>summarize_aw</code>: area-weighted covariates based on target and reference polygons</p></li>
</ul>
<div class="section level3">
<h3 id="function-selection-guide">Function selection guide<a class="anchor" aria-label="anchor" href="#function-selection-guide"></a>
</h3>
<p>We provide two flowcharts to help users choose the right function for parallel processing. The raster-oriented flowchart is for users who want to start with raster data, and the vector-oriented flowchart is for users with large vector data.</p>
<p>In <strong>raster-oriented selection</strong>, we suggest four factors to consider:</p>
<ul>
<li>Number of raster files: for multiple files, <code>par_multirasters</code> is recommended. When there are multiple rasters that share the same extent and resolution, consider stacking the rasters into multilayer SpatRaster object by calling <code>terra::rast(filenames)</code>.</li>
<li>Raster resolution: We suggest 100 meters as a threshold. Rasters with resolution coarser than 100 meters and a few layers would be better for the direct call of <code><a href="https://isciences.gitlab.io/exactextractr/reference/exact_extract.html" class="external-link">exactextractr::exact_extract()</a></code>.</li>
<li>Raster extent: Using <code>SpatRaster</code> in <code><a href="https://isciences.gitlab.io/exactextractr/reference/exact_extract.html" class="external-link">exactextractr::exact_extract()</a></code> is often minimally affected by the raster extent.</li>
<li>Memory size: <code>max_cells_in_memory</code> argument value of <code><a href="https://isciences.gitlab.io/exactextractr/reference/exact_extract.html" class="external-link">exactextractr::exact_extract()</a></code>, raster resolution, and the number of layers in <code>SpatRaster</code> are multiplicatively related to the memory usage.</li>
</ul>
<p><img src="reference/figures/README-flowchart-raster.png"></p>
<p>For <strong>vector-oriented selection</strong>, we suggest three factors to consider:</p>
<ul>
<li>Number of features: When the number of features is over 100,000, consider using <code>par_grid</code> or <code>par_hierarchy</code> to split the data into smaller chunks.</li>
<li>Hierarchical structure: If the data has a hierarchical structure, consider using <code>par_hierarchy</code> to parallelize the operation.</li>
<li>Data grouping: If the data needs to be grouped in similar sizes, consider using <code>par_pad_balanced</code> or <code>par_pad_grid</code> with <code>mode =     "grid_quantile"</code>.</li>
</ul>
<p><img src="reference/figures/README-flowchart-vector.png"></p>
</div>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p><code>chopin</code> can be installed using <code><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">remotes::install_github</a></code> (also possible with <code>pak::pak</code> or <code><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">devtools::install_github</a></code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/is_installed.html" class="external-link">check_installed</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"ropensci/chopin"</span><span class="op">)</span></span></code></pre></div>
<p>or you can also set <code>repos</code> in <code><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages()</a></code> as ROpenSci repository:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"chopin"</span>, repos <span class="op">=</span> <span class="st">"https://ropensci.r-universe.dev"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>Examples will navigate <code>par_grid</code>, <code>par_hierarchy</code>, and <code>par_multirasters</code> functions in <code>chopin</code> to parallelize geospatial operations.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check and install packages to run examples</span></span>
<span><span class="va">pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"chopin"</span>, <span class="st">"dplyr"</span>, <span class="st">"sf"</span>, <span class="st">"terra"</span>, <span class="st">"future"</span>, <span class="st">"future.mirai"</span>, <span class="st">"mirai"</span><span class="op">)</span></span>
<span><span class="co"># install packages if anything is unavailable</span></span>
<span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/is_installed.html" class="external-link">check_installed</a></span><span class="op">(</span><span class="va">pkgs</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/chopin">chopin</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.3.1; sf_use_s2() is TRUE</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.7.83</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.mirai.futureverse.org" class="external-link">future.mirai</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shikokuchuo.net/mirai/" class="external-link">mirai</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># disable spherical geometries</span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html" class="external-link">sf_use_s2</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched off</span></span>
<span></span>
<span><span class="co"># parallelization-safe random number generator</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2024</span>, kind <span class="op">=</span> <span class="st">"L'Ecuyer-CMRG"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="par_grid-parallelize-over-artificial-grid-polygons">
<code>par_grid</code>: parallelize over artificial grid polygons<a class="anchor" aria-label="anchor" href="#par_grid-parallelize-over-artificial-grid-polygons"></a>
</h3>
<p>Please refer to a small example below for extracting mean altitude values at circular point buffers and census tracts in North Carolina. Before running code chunks below, set the cloned <code>chopin</code> repository as your working directory with <code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd()</a></code></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncpoly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shape/nc.shp"</span>, package <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span>
<span><span class="va">ncsf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="va">ncpoly</span><span class="op">)</span></span>
<span><span class="va">ncsf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">ncsf</span>, <span class="st">"EPSG:5070"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">ncsf</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-read-nc-1.png" width="100%"></p>
<div class="section level4">
<h4 id="generate-random-points-in-nc">Generate random points in NC<a class="anchor" aria-label="anchor" href="#generate-random-points-in-nc"></a>
</h4>
<p>Ten thousands random point locations were generated inside the counties of North Carolina.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncpoints</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html" class="external-link">st_sample</a></span><span class="op">(</span><span class="va">ncsf</span>, <span class="fl">1e4</span><span class="op">)</span></span>
<span><span class="va">ncpoints</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">ncpoints</span><span class="op">)</span></span>
<span><span class="va">ncpoints</span><span class="op">$</span><span class="va">pid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"PID-%05d"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1e4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">ncpoints</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-gen-ncpoints-1.png" width="100%"></p>
</div>
<div class="section level4">
<h4 id="target-raster-dataset-shuttle-radar-topography-mission">Target raster dataset: <a href="https://www.usgs.gov/centers/eros/science/usgs-eros-archive-digital-elevation-shuttle-radar-topography-mission-srtm-1" class="external-link">Shuttle Radar Topography Mission</a>
<a class="anchor" aria-label="anchor" href="#target-raster-dataset-shuttle-radar-topography-mission"></a>
</h4>
<p>We use an elevation dataset with and a moderate spatial resolution (approximately 400 meters or 0.25 miles).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># data preparation</span></span>
<span><span class="va">wdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"chopin"</span><span class="op">)</span></span>
<span><span class="va">srtm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"nc_srtm15_otm.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># terra SpatRaster objects are wrapped when exported to rds file</span></span>
<span><span class="va">srtm_ras</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">srtm</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">srtm_ras</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"EPSG:5070"</span></span>
<span><span class="va">srtm_ras</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 1534, 2281, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 391.5026, 391.5026  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 1012872, 1905890, 1219961, 1820526  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : NAD83 / Conus Albers (EPSG:5070) </span></span>
<span><span class="co">#&gt; source      : nc_srtm15_otm.tif </span></span>
<span><span class="co">#&gt; name        :    srtm15 </span></span>
<span><span class="co">#&gt; min value   : -3589.291 </span></span>
<span><span class="co">#&gt; max value   :  1946.400</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">srtm_ras</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-load-srtm-1.png" width="100%"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ncpoints_tr &lt;- terra::vect(ncpoints)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">ncpoints_srtm</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">chopin</span><span class="fu">::</span><span class="fu"><a href="reference/extract_at.html">extract_at</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">srtm</span>,</span>
<span>      y <span class="op">=</span> <span class="va">ncpoints</span>,</span>
<span>      id <span class="op">=</span> <span class="st">"pid"</span>,</span>
<span>      mode <span class="op">=</span> <span class="st">"buffer"</span>,</span>
<span>      radius <span class="op">=</span> <span class="fl">1e4L</span>  <span class="co"># 10,000 meters (10 km)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   5.458   0.088   5.580</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="generate-regular-grid-computational-regions">Generate regular grid computational regions<a class="anchor" aria-label="anchor" href="#generate-regular-grid-computational-regions"></a>
</h4>
<p><code><a href="reference/par_pad_grid.html">chopin::par_pad_grid()</a></code> takes a spatial dataset to generate regular grid polygons with <code>nx</code> and <code>ny</code> arguments with padding. Users will have both overlapping (by the degree of <code>radius</code>) and non-overlapping grids, both of which will be utilized to split locations and target datasets into sub-datasets for efficient processing.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compregions</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">chopin</span><span class="fu">::</span><span class="fu"><a href="reference/par_pad_grid.html">par_pad_grid</a></span><span class="op">(</span></span>
<span>    <span class="va">ncpoints</span>,</span>
<span>    mode <span class="op">=</span> <span class="st">"grid"</span>,</span>
<span>    nx <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>    ny <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>    padding <span class="op">=</span> <span class="fl">1e4L</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Switch sf class to terra...</span></span>
<span><span class="co">#&gt; Switch terra class to sf...</span></span></code></pre></div>
<p><code>compregions</code> is a list object with two elements named <code>original</code> (non-overlapping grid polygons) and <code>padded</code> (overlapping by <code>padding</code>). The figures below illustrate the grid polygons with and without overlaps.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">compregions</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "original" "padded"</span></span>
<span></span>
<span><span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">compregions</span><span class="op">$</span><span class="va">original</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Original grids"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">compregions</span><span class="op">$</span><span class="va">padded</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Padded grids"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-compare-compregions-1.png" width="100%"></p>
</div>
<div class="section level4">
<h4 id="parallel-processing">Parallel processing<a class="anchor" aria-label="anchor" href="#parallel-processing"></a>
</h4>
<p>Using the grid polygons, we distribute the task of averaging elevations at 10,000 circular buffer polygons, which are generated from the random locations, with 10 kilometers radius by <code><a href="reference/par_grid.html">chopin::par_grid()</a></code>. Users always need to <strong>register</strong> multiple CPU threads (logical cores) for parallelization. <code>chopin::par_*()</code> functions are flexible in terms of supporting generic spatial operations in <code>sf</code> and <code>terra</code>, especially where two datasets are involved. Users can inject generic functions’ arguments (parameters) by writing them in the ellipsis (<code>...</code>) arguments, as demonstrated below:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future.mirai</span><span class="fu">::</span><span class="va"><a href="https://future.mirai.futureverse.org/reference/mirai_multisession.html" class="external-link">mirai_multisession</a></span>, workers <span class="op">=</span> <span class="fl">4L</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">ncpoints_srtm_mthr</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="reference/par_grid.html">par_grid</a></span><span class="op">(</span></span>
<span>      grids <span class="op">=</span> <span class="va">compregions</span>,</span>
<span>      fun_dist <span class="op">=</span> <span class="va">extract_at</span>,</span>
<span>      x <span class="op">=</span> <span class="va">srtm</span>,</span>
<span>      y <span class="op">=</span> <span class="va">ncpoints</span>,</span>
<span>      id <span class="op">=</span> <span class="st">"pid"</span>,</span>
<span>      radius <span class="op">=</span> <span class="fl">1e4L</span>,</span>
<span>      .standalone <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; ℹ Input is not a character.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...</span></span>
<span><span class="co">#&gt; ℹ Task at CGRIDID: 1 is successfully dispatched.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...</span></span>
<span><span class="co">#&gt; ℹ Task at CGRIDID: 2 is successfully dispatched.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...</span></span>
<span><span class="co">#&gt; ℹ Task at CGRIDID: 3 is successfully dispatched.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...</span></span>
<span><span class="co">#&gt; ℹ Task at CGRIDID: 4 is successfully dispatched.</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.336   0.045   7.788</span></span>
<span></span>
<span><span class="va">ncpoints_srtm</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="reference/extract_at.html">extract_at</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">srtm</span>,</span>
<span>    y <span class="op">=</span> <span class="va">ncpoints</span>,</span>
<span>    id <span class="op">=</span> <span class="st">"pid"</span>,</span>
<span>    radius <span class="op">=</span> <span class="fl">1e4L</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ncpoints_srtm_mthr</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"mean_par"</span></span>
<span><span class="va">ncpoints_compar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">ncpoints_srtm</span>, <span class="va">ncpoints_srtm_mthr</span><span class="op">)</span></span>
<span><span class="co"># Are the calculations equal?</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">ncpoints_compar</span><span class="op">$</span><span class="va">mean</span>, <span class="va">ncpoints_compar</span><span class="op">$</span><span class="va">mean_par</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncpoints_s</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">ncpoints</span>, <span class="va">ncpoints_srtm</span><span class="op">)</span></span>
<span><span class="va">ncpoints_m</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">ncpoints</span>, <span class="va">ncpoints_srtm_mthr</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ncpoints_s</span><span class="op">[</span>, <span class="st">"mean"</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"Single-thread"</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.33</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-plot%20results-1.png" width="100%"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ncpoints_m</span><span class="op">[</span>, <span class="st">"mean_par"</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"Multi-thread"</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.33</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-plot%20results-2.png" width="100%"></p>
<p>The same workflow operates on <code>mirai</code> dispatchers.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future</span><span class="fu">::</span><span class="va"><a href="https://future.futureverse.org/reference/sequential.html" class="external-link">sequential</a></span><span class="op">)</span></span>
<span><span class="fu">mirai</span><span class="fu">::</span><span class="fu"><a href="https://shikokuchuo.net/mirai/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">4L</span>, dispatcher <span class="op">=</span> <span class="st">"process"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">ncpoints_srtm_mthr</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="reference/par_grid_mirai.html">par_grid_mirai</a></span><span class="op">(</span></span>
<span>      grids <span class="op">=</span> <span class="va">compregions</span>,</span>
<span>      fun_dist <span class="op">=</span> <span class="va">extract_at</span>,</span>
<span>      x <span class="op">=</span> <span class="va">srtm</span>,</span>
<span>      y <span class="op">=</span> <span class="va">ncpoints</span>,</span>
<span>      id <span class="op">=</span> <span class="st">"pid"</span>,</span>
<span>      radius <span class="op">=</span> <span class="fl">1e4L</span>,</span>
<span>      .standalone <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; ℹ Input is not a character.</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.083   0.000   8.004</span></span>
<span></span>
<span><span class="co"># remove mirai::daemons</span></span>
<span><span class="fu">mirai</span><span class="fu">::</span><span class="fu"><a href="https://shikokuchuo.net/mirai/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span><span class="fl">0L</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="chopinpar_hierarchy-parallelize-geospatial-computations-using-intrinsic-data-hierarchy">
<code>chopin::par_hierarchy()</code>: parallelize geospatial computations using intrinsic data hierarchy<a class="anchor" aria-label="anchor" href="#chopinpar_hierarchy-parallelize-geospatial-computations-using-intrinsic-data-hierarchy"></a>
</h3>
<p>We usually have nested/exhaustive hierarchies in real-world datasets. For example, land is organized by administrative/jurisdictional borders where multiple levels exist. In the U.S. context, a state consists of several counties, counties are split into census tracts, and they have a group of block groups. <code><a href="reference/par_hierarchy.html">chopin::par_hierarchy()</a></code> leverages such hierarchies to parallelize geospatial operations, which means that a group of lower-level geographic units in a higher-level geography is assigned to a process. A demonstration below shows that census tracts are grouped by their counties then each county will be processed in a CPU thread.</p>
<div class="section level4">
<h4 id="read-data">Read data<a class="anchor" aria-label="anchor" href="#read-data"></a>
</h4>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># nc_hierarchy.gpkg includes two layers: county and tracts</span></span>
<span><span class="va">path_nchrchy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"nc_hierarchy.gpkg"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nc_data</span> <span class="op">&lt;-</span> <span class="va">path_nchrchy</span></span>
<span><span class="va">nc_county</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">nc_data</span>, layer <span class="op">=</span> <span class="st">"county"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading layer `county' from data source </span></span>
<span><span class="co">#&gt;   `/tmp/RtmpmJUPd2/temp_libpath3b3aa268543/chopin/extdata/nc_hierarchy.gpkg' </span></span>
<span><span class="co">#&gt;   using driver `GPKG'</span></span>
<span><span class="co">#&gt; Simple feature collection with 100 features and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 1054155 ymin: 1341756 xmax: 1838923 ymax: 1690176</span></span>
<span><span class="co">#&gt; Projected CRS: NAD83 / Conus Albers</span></span>
<span><span class="va">nc_tracts</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">nc_data</span>, layer <span class="op">=</span> <span class="st">"tracts"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading layer `tracts' from data source </span></span>
<span><span class="co">#&gt;   `/tmp/RtmpmJUPd2/temp_libpath3b3aa268543/chopin/extdata/nc_hierarchy.gpkg' </span></span>
<span><span class="co">#&gt;   using driver `GPKG'</span></span>
<span><span class="co">#&gt; Simple feature collection with 2672 features and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 1054155 ymin: 1341756 xmax: 1838923 ymax: 1690176</span></span>
<span><span class="co">#&gt; Projected CRS: NAD83 / Conus Albers</span></span>
<span></span>
<span><span class="co"># reproject to Conus Albers Equal Area</span></span>
<span><span class="va">nc_county</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">nc_county</span>, <span class="st">"EPSG:5070"</span><span class="op">)</span></span>
<span><span class="va">nc_tracts</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">nc_tracts</span>, <span class="st">"EPSG:5070"</span><span class="op">)</span></span>
<span><span class="va">nc_tracts</span><span class="op">$</span><span class="va">COUNTY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">nc_tracts</span><span class="op">$</span><span class="va">GEOID</span>, <span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="extract-average-srtm-elevations-by-single-and-multiple-threads">Extract average SRTM elevations by single and multiple threads<a class="anchor" aria-label="anchor" href="#extract-average-srtm-elevations-by-single-and-multiple-threads"></a>
</h4>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future.mirai</span><span class="fu">::</span><span class="va"><a href="https://future.mirai.futureverse.org/reference/mirai_multisession.html" class="external-link">mirai_multisession</a></span>, workers <span class="op">=</span> <span class="fl">4L</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># single-thread</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">nc_elev_tr_single</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">chopin</span><span class="fu">::</span><span class="fu"><a href="reference/extract_at.html">extract_at</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">srtm</span>,</span>
<span>      y <span class="op">=</span> <span class="va">nc_tracts</span>,</span>
<span>      id <span class="op">=</span> <span class="st">"GEOID"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.621   0.010   0.613</span></span>
<span></span>
<span><span class="co"># hierarchical parallelization</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">nc_elev_tr_distr</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">chopin</span><span class="fu">::</span><span class="fu"><a href="reference/par_hierarchy.html">par_hierarchy</a></span><span class="op">(</span></span>
<span>      regions <span class="op">=</span> <span class="va">nc_county</span>, <span class="co"># higher level geometry</span></span>
<span>      regions_id <span class="op">=</span> <span class="st">"GEOID"</span>, <span class="co"># higher level unique id</span></span>
<span>      fun_dist <span class="op">=</span> <span class="va">extract_at</span>,</span>
<span>      x <span class="op">=</span> <span class="va">srtm</span>,</span>
<span>      y <span class="op">=</span> <span class="va">nc_tracts</span>, <span class="co"># lower level geometry</span></span>
<span>      id <span class="op">=</span> <span class="st">"GEOID"</span>, <span class="co"># lower level unique id</span></span>
<span>      func <span class="op">=</span> <span class="st">"mean"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; ℹ Input is not a character.</span></span>
<span><span class="co">#&gt; ℹ GEOID is used to stratify the process.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37037 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37001 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37057 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37069 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37155 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37109 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37027 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37063 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37145 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37115 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37151 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37131 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37013 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37159 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37051 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37153 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37093 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37025 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37029 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37169 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37031 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37005 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37139 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37193 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37003 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37083 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37163 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37189 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37173 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37011 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37045 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37125 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37067 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37077 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37185 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37137 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37033 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37107 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37075 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37073 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37161 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37187 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37007 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37135 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37049 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37195 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37061 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37087 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37081 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37099 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37097 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37091 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37149 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37165 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37085 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37105 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37017 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37039 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37035 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37177 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37113 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37143 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37095 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37071 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37101 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37015 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37167 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37079 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37129 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37147 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37141 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37179 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37121 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37133 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37065 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37119 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37199 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37197 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37023 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37191 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37059 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37111 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37183 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37053 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37103 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37041 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37021 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37157 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37117 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37089 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37127 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37009 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37019 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37123 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37181 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37175 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37171 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37043 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37055 is dispatched.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...ℹ Your input function at 37047 is dispatched.</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.419   0.033   7.799</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="par_multirasters-parallelize-over-multiple-rasters">
<code>par_multirasters()</code>: parallelize over multiple rasters<a class="anchor" aria-label="anchor" href="#par_multirasters-parallelize-over-multiple-rasters"></a>
</h3>
<p>There is a common case of having a large group of raster files at which the same operation should be performed. <code><a href="reference/par_multirasters.html">chopin::par_multirasters()</a></code> is for such cases. An example below demonstrates where we have five elevation raster files to calculate the average elevation at counties in North Carolina.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># nccnty &lt;- sf::st_read(nc_data, layer = "county")</span></span>
<span><span class="va">ncelev</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">srtm</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">ncelev</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"EPSG:5070"</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ncelev</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"srtm15"</span><span class="op">)</span></span>
<span><span class="va">tdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">ncelev</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tdir</span>, <span class="st">"test1.tif"</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">ncelev</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tdir</span>, <span class="st">"test2.tif"</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">ncelev</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tdir</span>, <span class="st">"test3.tif"</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">ncelev</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tdir</span>, <span class="st">"test4.tif"</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">ncelev</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tdir</span>, <span class="st">"test5.tif"</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check if the raster files were exported as expected</span></span>
<span><span class="va">testfiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">tdir</span>, pattern <span class="op">=</span> <span class="st">"*.tif$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">testfiles</span></span>
<span><span class="co">#&gt; [1] "/tmp/RtmpiW9fAm/test1.tif" "/tmp/RtmpiW9fAm/test2.tif"</span></span>
<span><span class="co">#&gt; [3] "/tmp/RtmpiW9fAm/test3.tif" "/tmp/RtmpiW9fAm/test4.tif"</span></span>
<span><span class="co">#&gt; [5] "/tmp/RtmpiW9fAm/test5.tif"</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">chopin</span><span class="fu">::</span><span class="fu"><a href="reference/par_multirasters.html">par_multirasters</a></span><span class="op">(</span></span>
<span>      filenames <span class="op">=</span> <span class="va">testfiles</span>,</span>
<span>      fun_dist <span class="op">=</span> <span class="va">extract_at</span>,</span>
<span>      x <span class="op">=</span> <span class="va">ncelev</span>,</span>
<span>      y <span class="op">=</span> <span class="va">nc_county</span>,</span>
<span>      id <span class="op">=</span> <span class="st">"GEOID"</span>,</span>
<span>      func <span class="op">=</span> <span class="st">"mean"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; ℹ Input is not a character.</span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...</span></span>
<span><span class="co">#&gt; ℹ Your input function at /tmp/RtmpiW9fAm/test1.tif is dispatched.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...</span></span>
<span><span class="co">#&gt; ℹ Your input function at /tmp/RtmpiW9fAm/test2.tif is dispatched.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...</span></span>
<span><span class="co">#&gt; ℹ Your input function at /tmp/RtmpiW9fAm/test3.tif is dispatched.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...</span></span>
<span><span class="co">#&gt; ℹ Your input function at /tmp/RtmpiW9fAm/test4.tif is dispatched.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Input is a character. Attempt to read it with terra::rast...</span></span>
<span><span class="co">#&gt; ℹ Your input function at /tmp/RtmpiW9fAm/test5.tif is dispatched.</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   1.288   0.090   2.901</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr>
<th align="right">mean</th>
<th align="left">base_raster</th>
</tr></thead>
<tbody>
<tr>
<td align="right">136.80203</td>
<td align="left">/tmp/RtmpiW9fAm/test1.tif</td>
</tr>
<tr>
<td align="right">189.76170</td>
<td align="left">/tmp/RtmpiW9fAm/test1.tif</td>
</tr>
<tr>
<td align="right">231.16968</td>
<td align="left">/tmp/RtmpiW9fAm/test1.tif</td>
</tr>
<tr>
<td align="right">98.03845</td>
<td align="left">/tmp/RtmpiW9fAm/test1.tif</td>
</tr>
<tr>
<td align="right">41.23463</td>
<td align="left">/tmp/RtmpiW9fAm/test1.tif</td>
</tr>
<tr>
<td align="right">270.96933</td>
<td align="left">/tmp/RtmpiW9fAm/test1.tif</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># remove temporary raster files</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="va">testfiles</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE TRUE TRUE TRUE TRUE</span></span></code></pre></div>
<!--| GEOID |      mean |
|:------|----------:|
| 37037 | 136.80203 |
| 37001 | 189.76170 |
| 37057 | 231.16968 |
| 37069 |  98.03845 |
| 37155 |  41.23463 |
| 37109 | 270.96933 |
-->
</div>
</div>
<div class="section level2">
<h2 id="parallelization-of-a-generic-geospatial-operation">Parallelization of a generic geospatial operation<a class="anchor" aria-label="anchor" href="#parallelization-of-a-generic-geospatial-operation"></a>
</h2>
<p>Other than <code>chopin</code> processing functions, <code>chopin::par_*()</code> functions support generic geospatial operations. An example below uses <code><a href="https://rspatial.github.io/terra/reference/nearby.html" class="external-link">terra::nearest()</a></code>, which gets the nearest feature’s attributes, inside <code><a href="reference/par_grid.html">chopin::par_grid()</a></code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path_ncrd1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"ncroads_first.gpkg"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate 5000 random points</span></span>
<span><span class="va">pnts</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html" class="external-link">st_sample</a></span><span class="op">(</span><span class="va">nc_county</span>, <span class="fl">5000</span><span class="op">)</span></span>
<span><span class="va">pnts</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">pnts</span><span class="op">)</span></span>
<span><span class="co"># assign identifiers</span></span>
<span><span class="va">pnts</span><span class="op">$</span><span class="va">pid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"RPID-%04d"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rd1</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">path_ncrd1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading layer `ncroads_first' from data source </span></span>
<span><span class="co">#&gt;   `/tmp/RtmpmJUPd2/temp_libpath3b3aa268543/chopin/extdata/ncroads_first.gpkg' </span></span>
<span><span class="co">#&gt;   using driver `GPKG'</span></span>
<span><span class="co">#&gt; Simple feature collection with 620 features and 4 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTILINESTRING</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 1152512 ymin: 1390719 xmax: 1748367 ymax: 1662294</span></span>
<span><span class="co">#&gt; Projected CRS: NAD83 / Conus Albers</span></span>
<span></span>
<span><span class="co"># reproject</span></span>
<span><span class="va">pntst</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">pnts</span>, <span class="st">"EPSG:5070"</span><span class="op">)</span></span>
<span><span class="va">rd1t</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">rd1</span>, <span class="st">"EPSG:5070"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate grids</span></span>
<span><span class="va">nccompreg</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">chopin</span><span class="fu">::</span><span class="fu"><a href="reference/par_pad_grid.html">par_pad_grid</a></span><span class="op">(</span></span>
<span>    input <span class="op">=</span> <span class="va">pntst</span>,</span>
<span>    mode <span class="op">=</span> <span class="st">"grid"</span>,</span>
<span>    nx <span class="op">=</span> <span class="fl">4L</span>,</span>
<span>    ny <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>    padding <span class="op">=</span> <span class="fl">5e4L</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Switch sf class to terra...</span></span>
<span><span class="co">#&gt; Switch terra class to sf...</span></span></code></pre></div>
<p>The figure below shows the padded grids (50 kilometers), primary roads, and points. Primary roads will be selected by a padded grid per iteration and used to calculate the distance from each point to the nearest primary road. Padded grids and their overlapping areas will look different according to <code>padding</code> argument in <code><a href="reference/par_pad_grid.html">chopin::par_pad_grid()</a></code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nccompreg</span><span class="op">$</span><span class="va">padded</span>, border <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">ncsf</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rd1t</span>, col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in plot.sf(rd1t, col = "blue", add = TRUE): ignoring all but the first</span></span>
<span><span class="co">#&gt; attribute</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pntst</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, cex <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="fl">1.02e6</span>, <span class="fl">1.72e6</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Computation grids (50km padding)"</span>, <span class="st">"Major roads"</span><span class="op">)</span>,</span>
<span>       lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"orange"</span>, <span class="st">"blue"</span><span class="op">)</span>,</span>
<span>       cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-map-all-1.png" width="100%"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># terra::nearest run</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">restr</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/nearby.html" class="external-link">nearest</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">pntst</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">rd1t</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.396   0.000   0.397</span></span>
<span></span>
<span><span class="va">pnt_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tdir</span>, <span class="st">"pntst.gpkg"</span><span class="op">)</span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">pntst</span>, <span class="va">pnt_path</span><span class="op">)</span></span>
<span><span class="co">#&gt; Writing layer `pntst' to data source `/tmp/RtmpiW9fAm/pntst.gpkg' using driver `GPKG'</span></span>
<span><span class="co">#&gt; Writing 5000 features with 1 fields and geometry type Point.</span></span>
<span></span>
<span><span class="co"># we use four threads that were configured above</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">resd</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">chopin</span><span class="fu">::</span><span class="fu"><a href="reference/par_grid.html">par_grid</a></span><span class="op">(</span></span>
<span>      grids <span class="op">=</span> <span class="va">nccompreg</span>,</span>
<span>      fun_dist <span class="op">=</span> <span class="va">nearest</span>,</span>
<span>      x <span class="op">=</span> <span class="va">pnt_path</span>,</span>
<span>      y <span class="op">=</span> <span class="va">path_ncrd1</span>,</span>
<span>      pad_y <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; ℹ Input is a character. Trying to read with terra .</span></span>
<span><span class="co">#&gt; ℹ Input is a character. Trying to read with terra .</span></span>
<span><span class="co">#&gt; ℹ Task at CGRIDID: 1 is successfully dispatched.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Input is a character. Trying to read with terra .</span></span>
<span><span class="co">#&gt; ℹ Input is a character. Trying to read with terra .</span></span>
<span><span class="co">#&gt; ℹ Task at CGRIDID: 2 is successfully dispatched.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Input is a character. Trying to read with terra .</span></span>
<span><span class="co">#&gt; ℹ Input is a character. Trying to read with terra .</span></span>
<span><span class="co">#&gt; ℹ Task at CGRIDID: 3 is successfully dispatched.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Input is a character. Trying to read with terra .</span></span>
<span><span class="co">#&gt; ℹ Input is a character. Trying to read with terra .</span></span>
<span><span class="co">#&gt; ℹ Task at CGRIDID: 4 is successfully dispatched.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Input is a character. Trying to read with terra .</span></span>
<span><span class="co">#&gt; ℹ Input is a character. Trying to read with terra .</span></span>
<span><span class="co">#&gt; ℹ Task at CGRIDID: 5 is successfully dispatched.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Input is a character. Trying to read with terra .</span></span>
<span><span class="co">#&gt; ℹ Input is a character. Trying to read with terra .</span></span>
<span><span class="co">#&gt; ℹ Task at CGRIDID: 6 is successfully dispatched.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Input is a character. Trying to read with terra .</span></span>
<span><span class="co">#&gt; ℹ Input is a character. Trying to read with terra .</span></span>
<span><span class="co">#&gt; ℹ Task at CGRIDID: 7 is successfully dispatched.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Input is a character. Trying to read with terra .</span></span>
<span><span class="co">#&gt; ℹ Input is a character. Trying to read with terra .</span></span>
<span><span class="co">#&gt; ℹ Task at CGRIDID: 8 is successfully dispatched.</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.058   0.010   0.401</span></span></code></pre></div>
<ul>
<li>We will compare the results from the single-thread and multi-thread calculation.</li>
</ul>
<!-- end list --><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">restr</span>, <span class="va">resd</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"from_x"</span>, <span class="st">"from_y"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">resj</span><span class="op">$</span><span class="va">distance.x</span>, <span class="va">resj</span><span class="op">$</span><span class="va">distance.y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Users should be mindful of caveats in the parallelization of nearest feature search, which may result in no or excess distance depending on the distribution of the target dataset to which the nearest feature is searched. For example, when one wants to calculate the nearest interstate from rural homes with fine grids, some grids may have no interstates then homes in such grids will not get any distance to the nearest interstate. Such problems can be avoided by choosing <code>nx</code>, <code>ny</code>, and <code>padding</code> values in <code><a href="reference/par_pad_grid.html">par_pad_grid()</a></code> meticulously.</p>
</div>
<div class="section level2">
<h2 id="caveats">Caveats<a class="anchor" aria-label="anchor" href="#caveats"></a>
</h2>
<div class="section level3">
<h3 id="why-parallelization-is-slower-than-the-ordinary-function-run">Why parallelization is slower than the ordinary function run?<a class="anchor" aria-label="anchor" href="#why-parallelization-is-slower-than-the-ordinary-function-run"></a>
</h3>
<p>Parallelization may underperform when the datasets are too small to take advantage of divide-and-compute approach, where parallelization overhead is involved. Overhead here refers to the required amount of computational resources for transferring objects to multiple processes. Since the demonstrations above use quite small datasets, the advantage of parallelization was not as noticeable as it was expected. Should a large amount of data (spatial/temporal resolution or number of files, for example) be processed, users could find the efficiency of this package. A vignette in this package demonstrates use cases extracting various climate/weather datasets.</p>
</div>
<div class="section level3">
<h3 id="notes-on-data-restrictions">Notes on data restrictions<a class="anchor" aria-label="anchor" href="#notes-on-data-restrictions"></a>
</h3>
<p><code>chopin</code> works best with <strong>two-dimensional</strong> (<strong>planar</strong>) geometries. Users should disable <code>s2</code> spherical geometry mode in <code>sf</code> by setting <code>sf::sf_use_s2(FALSE)</code>. Running any <code>chopin</code> functions at spherical or three-dimensional (e.g., including M/Z dimensions) geometries may produce incorrect or unexpected results.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/ropensci/chopin/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/ropensci/chopin/issues" class="external-link">Report a bug</a></li>
</ul>
</div>



<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing chopin</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Insang Song <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-8732-3256" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Kyle Messier <br><small class="roles"> Author, contributor </small> <a href="https://orcid.org/0000-0001-9508-9623" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="r-universe">
<h2 data-toc-skip>R-universe</h2>
<ul class="list-unstyled">
<li><p><a href="https://ropensci.r-universe.dev/chopin" class="external-link"><img src="https://ropensci.r-universe.dev/badges/chopin" alt="chopin status badge"></a></p></li>
</ul>
</div>

<div class="software-peer-review">
<h2 data-toc-skip>Software Peer-Review</h2>
<ul class="list-unstyled">
<li><p><a href="https://github.com/ropensci/software-review/issues/638" class="external-link"><img src="https://badges.ropensci.org/638_status.svg" alt="rOpenSci peer-review"></a></p></li>
</ul>
</div>

  </aside>
</div>


    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>





  </body>
</html>
